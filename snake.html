<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
    <link rel="stylesheet" href="/JQuery/reset.css">
    <style>
        .gamebackground{
            width: 100%;
            height: 800px;
            background-color: #ccc;
            position: relative;
        }
        .snake{
            background-color: #fff;
            width: 20px;
            height: 20px;
            position:absolute;
            border-radius: 50px;
        }
        .snake1{
            left: 400px;
            top: 200px;
        }
        .snake2{
            left: 380px;
            top: 200px;
        }
        .snake3{
            left: 360px;
            top:200px
        }
        .snake4{
            left: 340px;
            top:200px
        }
    </style>
</head>

<body>

    <div class="gamebackground">    
        <div class="snake snake1"></div>
        <div class="snake snake2"></div>
        <div class="snake snake3"></div>
        <div class="snake snake4"></div>
    </div>
    <!-- <button class="click">click</button> -->
    <script src="https://code.jquery.com/jquery-3.6.1.slim.min.js" integrity="sha256-w8CvhFs7iHNVUtnSP0YKEg00p9Ih13rlL9zGqvLdePA=" crossorigin="anonymous"></script>
    <script>

        let x ;
        let y ;

        let diretion = 'y'

        let ballX = $('.snake1').width()

        let ballY = $('.snake1').height()

        let max_X = ($('.gamebackground').width()) - ballX
        // console.log('畫面總長',max_X);
        let max_Y = ($('.gamebackground').height()) - ballY
        // console.log('畫面總寬',max_Y);
        let snakeX = $('.snake1').position().left
        let snakeY = $('.snake1').position().top
        console.log(snakeX,snakeY);
        let right = null;
        let up = null;
        let down = null;
        let left = null;
        let oldsnake = [
            {snakeX: 400, snakeY: 200},
            {snakeX: 380, snakeY: 200},
            {snakeX: 360, snakeY: 200},
            {snakeX: 340, snakeY: 200}
        ]


        let snake_big = 1

        $('.click').click(function(){
            
        })


        $(document).on('keydown',function(i){
            let k = i.keyCode
            // console.log(k);
            if(k === 38 || k === 87){
                i.preventDefault()
                // console.log('w');
                stopUp()
                stopDown()
                stopRight()
                stopLeft()
                Up()
            }
            if(k === 37 || k === 65){
                i.preventDefault()
                // console.log('a');
                stopLeft()
                stopDown()
                stopUp()
                stopRight()
                Left()        
            }
            if(k === 40 || k === 83){
                i.preventDefault()
                // console.log('s');
                stopDown()
                stopRight()
                stopUp()
                stopLeft()
                Down()
            }
            if(k === 39 || k === 68){
                i.preventDefault()
                // console.log('d');
                stopRight()
                stopDown()
                stopUp()
                stopLeft()
                Right()
            }
            if(k ==32){
                stopRight()
                stopDown()
                stopUp()
                stopLeft()
            }
            if(k == 78){
                snake_big = snake_big + 1
                $('.gamebackground').append(`<div class="snake snake${snake_big}"></div>`)
                $(`.snake${snake_big}`).css({
                    left:oldsnake[(snake_big - 2)].snakeX,
                    top:oldsnake[(snake_big - 2)].snakeY
                })
            }
        })




        function Right(){
            right = setInterval(function(){
                snakeX = snakeX + 20
                snakeBig()
                
                checkX()
                // console.log(snakeX,snakeY);
                $('.snake1').css('left',snakeX)
            },500)
        }
        function Up(){
            up = setInterval(function(){
                snakeY = snakeY - 20
                snakeBig()
                
                checkY()
                // console.log(snakeX,snakeY);
                $('.snake1').css('top',snakeY)
            },500)
        }
        function Down(){
            down = setInterval(function(){
                snakeY = snakeY + 20
                snakeBig()
                checkY()
                // console.log(snakeX,snakeY);
                $('.snake1').css('top',snakeY)
            },500)
        }
        function Left(){
            left = setInterval(function(){  
                snakeX = snakeX - 20
                snakeBig()
                checkX()
                // console.log(snakeX,snakeY);
                $('.snake1').css('left',snakeX)
            },500)
        }
        function stopRight(){
            clearInterval(right)
        }
        function stopUp(){
            clearInterval(up)
        }
        function stopDown(){
            clearInterval(down)
        }
        function stopLeft(){
            clearInterval(left)
        }

        function checkX(){
            if( snakeX > max_X){
                snakeX = 0
            }else if (snakeX < 0){
                snakeX = max_X
            }
        }
        function checkY(){
            if( snakeY > max_Y){
                snakeY = 0
            }else if (snakeY < 0){
                snakeY = max_Y
            }
        }
        function snakeBig(){
            oldsnake.unshift({snakeX,snakeY})
                if(oldsnake.length > 4){
                    console.log(oldsnake[0],oldsnake[1],oldsnake[2],oldsnake[3],oldsnake[4]);
                    oldsnake.pop()
                }
            $('.snake1').css({
                left:oldsnake[0].snakeX,
                top:oldsnake[0].snakeY
            })
            $('.snake2').css({
                left:oldsnake[1].snakeX,
                top:oldsnake[1].snakeY
            })
            $('.snake3').css({
                left:oldsnake[2].snakeX,
                top:oldsnake[2].snakeY
            })
            $('.snake4').css({
                left:oldsnake[3].snakeX,
                top:oldsnake[3].snakeY
            })
            // console.log(oldsnake[0]);
        }

    </script>

</body>

</html>